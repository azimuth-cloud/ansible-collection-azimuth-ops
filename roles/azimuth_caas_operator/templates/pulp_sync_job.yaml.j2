# TODO: THIS IS TOTALLY MADEUP
apiVersion: batch/v1
kind: Job
metadata:
  name: pulp_sync
# TODO: do we run this in the pulp namespace?
spec:
  template:
    spec:
      containers:
      - name: pulp_sync
        image: rockylinux/rockylinux:9.5 # TODO: can we replace this with whatever the execution environment is??
        command: ["bash",  "-c"]
        args:
        - |
          dnf install -y git python39
          git clone {{ azimuth_caas_stackhpc_slurm_appliance_git_url }}
          git checkout {{ azimuth_caas_stackhpc_slurm_appliance_git_version }}
          cd ansible-slurm-appliance
          ./dev/setup-env.sh
          # TODO: do we need to generate an environment to be able to use it??
          # TODO: what about the pulp config/secrets
          . venv/bin/activate
          # TODO: activate environment?
          ansible-playbook -v ansible/adhoc/sync-pulp.yml
      restartPolicy: Never
  backoffLimit: 4

# looks like we need to set:
pulp_site_url:
pulp_site_port: # although squeezer doesn't take this?
pulp_site_username
pulp_site_password
_cache_dir ?