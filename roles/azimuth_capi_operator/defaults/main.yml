---

# The chart to use
azimuth_capi_operator_chart_repo: https://azimuth-cloud.github.io/azimuth-capi-operator
azimuth_capi_operator_chart_name: azimuth-capi-operator
azimuth_capi_operator_chart_version: 0.15.0

# Release information for the CAPI operator release
# Use the same namespace as Azimuth by default
azimuth_capi_operator_release_namespace: "{{ azimuth_release_namespace | default('azimuth') }}"
azimuth_capi_operator_release_name: azimuth-capi-operator

# The timeout to wait for CAPI operator to become ready
azimuth_capi_operator_wait_timeout: 10m

# Custom trust bundle for SSL verification
azimuth_capi_operator_trust_bundle: "{{ system_trust_ca_bundle | default('') }}"

# The timer interval to use for the CAPI operator
azimuth_capi_operator_timer_interval: 60

# variable to toggle metrics
azimuth_capi_operator_metrics: true

# The repo, name and version for the CAPI Helm charts
# Leave blank to use the operator defaults
azimuth_capi_operator_capi_helm_chart_repo:
azimuth_capi_operator_capi_helm_chart_name:
azimuth_capi_operator_capi_helm_chart_version:
# The ID of the external network to use if there are multiple external networks
# If specified here, the network MUST be shared by all tenants
# If not given the external network is discovered, which only works if there is exactly
# one external network available to a project
azimuth_capi_operator_external_network_id:
# Indicates the CIDR blocks to use for pods and services of provisioned clusters respectively
# Leave blank for the chart defaults
azimuth_capi_operator_capi_helm_pods_cidr:
azimuth_capi_operator_capi_helm_services_cidr:
# The DNS nameservers for provisioned clusters
# Leave blank for the chart defaults
azimuth_capi_operator_capi_helm_dns_nameservers:
# Bundle of certificates that should be added to the system trustroots for provisioned clusters
# e.g. for pulling containers from a registry with a custom CA chain
azimuth_capi_operator_capi_helm_trust_bundle: >-
  {{ system_trust_extra_root_cas | default(trust_bundle) | default({}) }}
# The registry mirrors for provisioned clusters
azimuth_capi_operator_capi_helm_registry_mirrors: >-
  {{-
    harbor_registry_mirrors
    if harbor_registry_mirrors is defined
    else {}
  }}
# The additional packages for provisioned clusters
azimuth_capi_operator_capi_helm_additional_packages: []
# Work out the ansible-init collections to use for tenant clusters
azimuth_capi_operator_ansible_init_collections_default: >-
  {{ ansible_init_default_collections | default([]) }}
azimuth_capi_operator_ansible_init_collections_extra: []
azimuth_capi_operator_ansible_init_collections: >-
  {{
    azimuth_capi_operator_ansible_init_collections_default +
    azimuth_capi_operator_ansible_init_collections_extra
  }}

# Work out the ansible-init playbooks to use for tenant clusters
azimuth_capi_operator_ansible_init_playbooks_default: >-
  {{ ansible_init_default_playbooks | default([]) }}
azimuth_capi_operator_ansible_init_playbooks_extra: []
azimuth_capi_operator_ansible_init_playbooks: >-
  {{
    azimuth_capi_operator_ansible_init_playbooks_default +
    azimuth_capi_operator_ansible_init_playbooks_extra
  }}

# Metadata to associate with the machines in provisioned clusters
# By default, we set the metadata for the ansible-init collections and playbooks
azimuth_capi_operator_capi_helm_machine_metadata_defaults: |-
  {
    {% for collection in azimuth_capi_operator_ansible_init_collections %}
    "ansible_init_coll_{{ loop.index0 }}_name": "{{ collection.name }}",
    "ansible_init_coll_{{ loop.index0 }}_type": "{{ collection.type }}",
    "ansible_init_coll_{{ loop.index0 }}_version": "{{ collection.version }}",
    {% if collection.source is defined %}
    "ansible_init_coll_{{ loop.index0 }}_source": "{{ collection.source }}",
    {% endif %}
    {% endfor %}
    {% for playbook in azimuth_capi_operator_ansible_init_playbooks %}
    "ansible_init_pb_{{ loop.index0 }}_name": "{{ playbook.name }}",
    {% if playbook.stage is defined %}
    "ansible_init_pb_{{ loop.index0 }}_stage": "{{ playbook.stage }}",
    {% endif %}
    {% endfor %}
  }
azimuth_capi_operator_capi_helm_machine_metadata_overrides: {}
azimuth_capi_operator_capi_helm_machine_metadata: >-
  {{-
    azimuth_capi_operator_capi_helm_machine_metadata_defaults |
      combine(azimuth_capi_operator_capi_helm_machine_metadata_overrides, recursive = True)
  }}

# Indicates whether the failure domain (availability zone) should be omitted from control plane nodes
# Omitting the failure domain allows OpenStack to select a suitable AZ based on other scheduling constraints
azimuth_capi_operator_capi_helm_control_plane_omit_failure_domain: false
# A list of failure domains (availability zones) to consider for control plane nodes
# Only used when azimuth_capi_operator_capi_helm_control_plane_omit_failure_domain = false
# If not given, all availability zones will be considered for control plane nodes
azimuth_capi_operator_capi_helm_control_plane_failure_domains:
# The failure domain (availability zone) to use for workers
# Set to null to let OpenStack select a suitable AZ based on other scheduling constraints
azimuth_capi_operator_capi_helm_worker_failure_domain: nova

# The size of the root disks if boot-from-volume is required
# Leave blank to use the root disk from the flavor
azimuth_capi_operator_capi_helm_root_volume_size:
azimuth_capi_operator_capi_helm_control_plane_root_volume_size: "{{ azimuth_capi_operator_capi_helm_root_volume_size }}"
azimuth_capi_operator_capi_helm_worker_root_volume_size: "{{ azimuth_capi_operator_capi_helm_root_volume_size }}"
# The volume type for the root disk
# Leave blank for the default volume type
azimuth_capi_operator_capi_helm_root_volume_type:
azimuth_capi_operator_capi_helm_control_plane_root_volume_type: "{{ azimuth_capi_operator_capi_helm_root_volume_type }}"
azimuth_capi_operator_capi_helm_worker_root_volume_type: "{{ azimuth_capi_operator_capi_helm_root_volume_type }}"
# The Cinder availability zone for the root disk
# If set to null, the compute availability zone for the node will be used
azimuth_capi_operator_capi_helm_root_volume_availability_zone:
azimuth_capi_operator_capi_helm_control_plane_root_volume_availability_zone: "{{ azimuth_capi_operator_capi_helm_root_volume_availability_zone }}"
azimuth_capi_operator_capi_helm_worker_root_volume_availability_zone: "{{ azimuth_capi_operator_capi_helm_root_volume_availability_zone }}"

# Default size of the etcd block device for tenant clusters (in GB)
azimuth_capi_operator_capi_helm_etcd_blockdevice_size: 0
# Default block device type for etcd in tenant clusters ('Local' or 'Volume')
azimuth_capi_operator_capi_helm_etcd_blockdevice_type: "Volume"
# Default volume type for the etcd block device if 'Volume' type is used
azimuth_capi_operator_capi_helm_etcd_blockdevice_volume_type: # e.g., 'SSD'
# Default availability zone for the etcd block device if 'Volume' type is used
azimuth_capi_operator_capi_helm_etcd_blockdevice_volume_az: "nova"

# Options for LoadBalancer services
# https://github.com/kubernetes/cloud-provider-openstack/blob/master/docs/openstack-cloud-controller-manager/using-openstack-cloud-controller-manager.md#load-balancer
azimuth_capi_operator_capi_helm_openstack_loadbalancer_method: >-
  {{-
    'SOURCE_IP_PORT'
    if azimuth_capi_operator_capi_helm_openstack_loadbalancer_provider == 'ovn'
    else None
    }}

azimuth_capi_operator_capi_helm_azimuth_authorization_webhook_config:
  server: "{{ hostvars[groups.azimuth_deploy.0]['azimuth_authorization_webhook_server'] }}"
  tls:
    enabled: true
    cert: "{{ hostvars[groups.azimuth_deploy.0]['azimuth_authorization_webhook_tls_cert'] }}"
  filteredNamespaces: "{{ hostvars[groups.azimuth_deploy.0]['azimuth_authorization_webhook_filtered_namespaces'] }}"

azimuth_capi_operator_capi_helm_openstack_loadbalancer_provider:
azimuth_capi_operator_capi_helm_openstack_loadbalancer_create_monitor:
azimuth_capi_operator_capi_helm_openstack_loadbalancer_monitor_delay:
azimuth_capi_operator_capi_helm_openstack_loadbalancer_monitor_max_retries:
azimuth_capi_operator_capi_helm_openstack_loadbalancer_monitor_timeout:
azimuth_capi_operator_capi_helm_openstack_loadbalancer_flavor_id:
azimuth_capi_operator_capi_helm_openstack_loadbalancer_availability_zone:
azimuth_capi_operator_capi_helm_openstack_loadbalancer_max_shared_lb:
# The metadata search order
azimuth_capi_operator_capi_helm_openstack_metadata_search_order:
# Options for OpenStack block storage
# https://github.com/kubernetes/cloud-provider-openstack/blob/master/docs/cinder-csi-plugin/using-cinder-csi-plugin.md#block-storage
azimuth_capi_operator_capi_helm_openstack_block_storage_node_volume_attach_limit:
azimuth_capi_operator_capi_helm_openstack_block_storage_rescan_on_resize:
azimuth_capi_operator_capi_helm_openstack_block_storage_ignore_volume_az: true

# The Cinder availability zone for the default Cinder CSI storage class
azimuth_capi_operator_capi_helm_csi_cinder_default_availability_zone: nova
# The Cinder volume type for the default Cinder CSI storage class
azimuth_capi_operator_capi_helm_csi_cinder_default_volume_type:

azimuth_capi_operator_capi_helm_values_defaults:
  machineMetadata: "{{ azimuth_capi_operator_capi_helm_machine_metadata }}"
  kubeNetwork:
    pods: >-
      {{-
        { "cidrBlocks": [azimuth_capi_operator_capi_helm_pods_cidr] }
        if azimuth_capi_operator_capi_helm_pods_cidr
        else {}
      }}
    services: >-
      {{-
        { "cidrBlocks": [azimuth_capi_operator_capi_helm_services_cidr] }
        if azimuth_capi_operator_capi_helm_services_cidr
        else {}
      }}
  clusterNetworking: >-
    {{-
      {} |
        combine(
          { "externalNetworkId": azimuth_capi_operator_external_network_id }
          if azimuth_capi_operator_external_network_id
          else {}
        ) |
        combine(
          { "dnsNameservers": azimuth_capi_operator_capi_helm_dns_nameservers }
          if azimuth_capi_operator_capi_helm_dns_nameservers
          else {}
        )
    }}
  trustedCAs: "{{ azimuth_capi_operator_capi_helm_trust_bundle }}"
  registryMirrors: "{{ azimuth_capi_operator_capi_helm_registry_mirrors }}"
  additionalPackages: "{{ azimuth_capi_operator_capi_helm_additional_packages }}"
  controlPlane:
    omitFailureDomain: "{{ azimuth_capi_operator_capi_helm_control_plane_omit_failure_domain }}"
    failureDomains: "{{ azimuth_capi_operator_capi_helm_control_plane_failure_domains }}"
    machineRootVolume: >-
      {{-
        {} |
          combine(
            { "diskSize": azimuth_capi_operator_capi_helm_control_plane_root_volume_size }
            if azimuth_capi_operator_capi_helm_control_plane_root_volume_size
            else {}
          ) |
          combine(
            { "volumeType": azimuth_capi_operator_capi_helm_control_plane_root_volume_type }
            if azimuth_capi_operator_capi_helm_control_plane_root_volume_type
            else {}
          ) |
          combine(
            { "availabilityZone": azimuth_capi_operator_capi_helm_control_plane_root_volume_availability_zone }
            if azimuth_capi_operator_capi_helm_control_plane_root_volume_availability_zone
            else {}
          )
      }}
  nodeGroupDefaults:
    failureDomain: "{{ azimuth_capi_operator_capi_helm_worker_failure_domain }}"
    machineRootVolume: >-
      {{-
        {} |
          combine(
            { "diskSize": azimuth_capi_operator_capi_helm_worker_root_volume_size }
            if azimuth_capi_operator_capi_helm_worker_root_volume_size
            else {}
          ) |
          combine(
            { "volumeType": azimuth_capi_operator_capi_helm_worker_root_volume_type }
            if azimuth_capi_operator_capi_helm_worker_root_volume_type
            else {}
          ) |
          combine(
            { "availabilityZone": azimuth_capi_operator_capi_helm_worker_root_volume_availability_zone }
            if azimuth_capi_operator_capi_helm_worker_root_volume_availability_zone
            else {}
          )
      }}
  authWebhook: "{{ 'azimuth-authorization-webhook' if azimuth_authentication_type == 'oidc' else 'none' }}"
  azimuthAuthorizationWebhook: "{{ azimuth_capi_operator_capi_helm_azimuth_authorization_webhook_config if azimuth_authentication_type == 'oidc' else {} }}"
  addons:
    openstack:
      # General OpenStack configuration
      cloudConfig:
        LoadBalancer: >-
          {{-
            {} |
              combine(
                { "lb-method": azimuth_capi_operator_capi_helm_openstack_loadbalancer_method }
                if azimuth_capi_operator_capi_helm_openstack_loadbalancer_method
                else {}
              ) |
              combine(
                { "lb-provider": azimuth_capi_operator_capi_helm_openstack_loadbalancer_provider }
                if azimuth_capi_operator_capi_helm_openstack_loadbalancer_provider
                else {}
              ) |
              combine(
                { "create-monitor": "true" }
                if azimuth_capi_operator_capi_helm_openstack_loadbalancer_create_monitor
                else {}
              ) |
              combine(
                { "monitor-delay": azimuth_capi_operator_capi_helm_openstack_loadbalancer_monitor_delay }
                if azimuth_capi_operator_capi_helm_openstack_loadbalancer_monitor_delay
                else {}
              ) |
              combine(
                { "monitor-max-retries": azimuth_capi_operator_capi_helm_openstack_loadbalancer_monitor_max_retries }
                if azimuth_capi_operator_capi_helm_openstack_loadbalancer_monitor_max_retries
                else {}
              ) |
              combine(
                { "monitor-timeout": azimuth_capi_operator_capi_helm_openstack_loadbalancer_monitor_timeout }
                if azimuth_capi_operator_capi_helm_openstack_loadbalancer_monitor_timeout
                else {}
              ) |
              combine(
                { "flavor-id": azimuth_capi_operator_capi_helm_openstack_loadbalancer_flavor_id }
                if azimuth_capi_operator_capi_helm_openstack_loadbalancer_flavor_id
                else {}
              ) |
              combine(
                { "availability-zone": azimuth_capi_operator_capi_helm_openstack_loadbalancer_availability_zone }
                if azimuth_capi_operator_capi_helm_openstack_loadbalancer_availability_zone
                else {}
              ) |
              combine(
                { "max-shared-lb": azimuth_capi_operator_capi_helm_openstack_loadbalancer_max_shared_lb }
                if azimuth_capi_operator_capi_helm_openstack_loadbalancer_max_shared_lb
                else {}
              )
          }}
        Metadata: >-
          {{-
            {} |
              combine(
                { "search-order": azimuth_capi_operator_capi_helm_openstack_metadata_search_order }
                if azimuth_capi_operator_capi_helm_openstack_metadata_search_order
                else {}
              )
          }}
        BlockStorage: >-
          {{-
            {
              "ignore-volume-az": (
                "true"
                if azimuth_capi_operator_capi_helm_openstack_block_storage_ignore_volume_az
                else "false"
              )
            } |
              combine(
                { "node-volume-attach-limit": azimuth_capi_operator_capi_helm_openstack_block_storage_node_volume_attach_limit }
                if azimuth_capi_operator_capi_helm_openstack_block_storage_node_volume_attach_limit
                else {}
              ) |
              combine(
                { "rescan-on-resize": "true" }
                if azimuth_capi_operator_capi_helm_openstack_block_storage_rescan_on_resize
                else {}
              )
          }}
      # Configure the CSI Cinder storage class
      csiCinder:
        defaultStorageClass: >-
          {{-
            { "availabilityZone": azimuth_capi_operator_capi_helm_csi_cinder_default_availability_zone } |
              combine(
                { "volumeType": azimuth_capi_operator_capi_helm_csi_cinder_default_volume_type }
                if azimuth_capi_operator_capi_helm_csi_cinder_default_volume_type
                else {}
              )
          }}
    # Disable blackbox exporter (for now)
    monitoring:
      blackboxExporter:
        enabled: false
  etcd: >-
    {{-
      {
        "blockDevice": (
          {
            "size": azimuth_capi_operator_capi_helm_etcd_blockdevice_size,
            "type": azimuth_capi_operator_capi_helm_etcd_blockdevice_type
          } |
            combine(
              { "volumeType": azimuth_capi_operator_capi_helm_etcd_blockdevice_volume_type }
              if azimuth_capi_operator_capi_helm_etcd_blockdevice_volume_type
              else {}
            ) |
            combine(
              { "availabilityZone": azimuth_capi_operator_capi_helm_etcd_blockdevice_volume_az }
              if azimuth_capi_operator_capi_helm_etcd_blockdevice_volume_az
              else {}
            )
        )
      }
      if azimuth_capi_operator_capi_helm_etcd_blockdevice_size > 0
      else {}
    }}

# Overrides for the CAPI Helm chart releases for all clusters
azimuth_capi_operator_capi_helm_values_overrides: {}
# Default values for the CAPI Helm chart releases for all clusters
azimuth_capi_operator_capi_helm_values: >-
  {{-
    azimuth_capi_operator_capi_helm_values_defaults |
      combine(azimuth_capi_operator_capi_helm_values_overrides, recursive = True)
  }}


# The Zenith registrar admin URL for Zenith support
# If not given, Zenith support is not enabled
azimuth_capi_operator_zenith_registrar_admin_url: >-
  {{-
    azimuth_apps_registrar_admin_url
    if azimuth_apps_registrar_admin_url is defined
    else (
      zenith_registrar_admin_url
      if zenith_registrar_admin_url is defined
      else None
    )
  }}
# The host and port for the Zenith SSHD server
azimuth_capi_operator_zenith_sshd_host: >-
  {{-
    azimuth_apps_sshd_host
    if azimuth_apps_sshd_host is defined
    else (
      zenith_sshd_host
      if zenith_sshd_host is defined
      else None
    )
  }}
azimuth_capi_operator_zenith_sshd_port: >-
  {{-
    azimuth_apps_sshd_port
    if azimuth_apps_sshd_port is defined
    else (
      zenith_sshd_port
      if zenith_sshd_port is defined
      else 22
    )
  }}
# The Zenith chart repository and version to use for rendering API server manifests
# Leave blank for the operator defaults
azimuth_capi_operator_zenith_chart_repo:
azimuth_capi_operator_zenith_chart_version:
# Indicates whether Zenith clients should be created in debug mode
azimuth_capi_operator_zenith_client_debug: false
# Default values for the Zenith apiserver chart
azimuth_capi_operator_zenith_apiserver_defaults:
  zenithClient:
    debug: "{{ azimuth_capi_operator_zenith_client_debug }}"
azimuth_capi_operator_zenith_apiserver_overrides: {}
azimuth_capi_operator_zenith_apiserver_default_values: >-
  {{-
    azimuth_capi_operator_zenith_apiserver_defaults |
      combine(azimuth_capi_operator_zenith_apiserver_overrides, recursive = True)
  }}
# Default values for the Zenith operator chart
azimuth_capi_operator_zenith_operator_defaults:
  config:
    defaultDebug: "{{ azimuth_capi_operator_zenith_client_debug }}"
azimuth_capi_operator_zenith_operator_overrides: {}
azimuth_capi_operator_zenith_operator_default_values: >-
  {{-
    azimuth_capi_operator_zenith_operator_defaults |
      combine(azimuth_capi_operator_zenith_operator_overrides, recursive = True)
  }}

# The values for the release
azimuth_capi_operator_release_defaults:
  config:
    timerInterval: "{{ azimuth_capi_operator_timer_interval }}"
    capiHelm: >-
      {{-
        { "defaultValues": azimuth_capi_operator_capi_helm_values } |
          combine(
            { "chartRepository": azimuth_capi_operator_capi_helm_chart_repo }
            if azimuth_capi_operator_capi_helm_chart_repo
            else {}
          ) |
          combine(
            { "chartName": azimuth_capi_operator_capi_helm_chart_name }
            if azimuth_capi_operator_capi_helm_chart_name
            else {}
          ) |
          combine(
            { "chartVersion": azimuth_capi_operator_capi_helm_chart_version }
            if azimuth_capi_operator_capi_helm_chart_version
            else {}
          )
      }}
    identity:
      oidcEnabled: "{{ true if azimuth_authentication_type == 'oidc' else false }}"
    zenith: >-
      {{-
        {} |
          combine(
            {
              "registrarAdminUrl": azimuth_capi_operator_zenith_registrar_admin_url,
              "sshdHost": azimuth_capi_operator_zenith_sshd_host,
              "sshdPort": azimuth_capi_operator_zenith_sshd_port,
            }
            if azimuth_capi_operator_zenith_registrar_admin_url
            else {}
          ) |
          combine(
            { "chartRepository": azimuth_capi_operator_zenith_chart_repo }
            if azimuth_capi_operator_zenith_chart_repo
            else {}
          ) |
          combine(
            { "chartVersion": azimuth_capi_operator_zenith_chart_version }
            if azimuth_capi_operator_zenith_chart_version
            else {}
          ) |
          combine(
            { "apiserverDefaults": azimuth_capi_operator_zenith_apiserver_default_values }
          ) |
          combine(
            { "operatorDefaults": azimuth_capi_operator_zenith_operator_default_values }
          )
      }}
  # Enable the metrics with the service monitor by default
  metrics:
    enabled: "{{ azimuth_capi_operator_metrics }}"
  trustBundle: "{{ azimuth_capi_operator_trust_bundle }}"
azimuth_capi_operator_release_overrides: {}
azimuth_capi_operator_release_values: >-
  {{-
    azimuth_capi_operator_release_defaults |
      combine(azimuth_capi_operator_release_overrides, recursive = True)
  }}

#####
# Kubernetes template definitions
#
# These definitions represent the CURRENT Kubernetes templates
# All other templates will be marked as DEPRECATED
# azimuth-ops currently never removes templates
#####
# Tags for the default Kubernetes apps
azimuth_capi_operator_cluster_template_tags:
  - standard
# Settings for the default Kubernetes templates
azimuth_capi_operator_cluster_template_defaults:
  tags: "{{ azimuth_capi_operator_cluster_template_tags }}"
  values:
    clusterNetworking:
      internalNetwork:
        networkFilter:
          tags: portal-internal
# Tenancy-based access controls to apply to Kubernetes cluster templates
# List of allowed tenancy IDs
azimuth_capi_operator_cluster_template_tenancy_allow_list: "{{ platforms_tenancy_allow_list | default([]) }}"
# List of denied tenancy IDs
azimuth_capi_operator_cluster_template_tenancy_deny_list: "{{ platforms_tenancy_deny_list | default([]) }}"
# Regex pattern to allow tenancies by name
azimuth_capi_operator_cluster_template_tenancy_allow_regex: "{{ platforms_tenancy_allow_regex | default('') }}"
# Regex pattern to block tenancies by name
azimuth_capi_operator_cluster_template_tenancy_deny_regex: "{{ platforms_tenancy_deny_regex | default('') }}"
# The set of key-value annotations to apply to the clusters templates
azimuth_capi_operator_cluster_template_annotations:
  acl.azimuth.stackhpc.com/allow-list: "{{ azimuth_capi_operator_cluster_template_tenancy_allow_list | join(',') }}"
  acl.azimuth.stackhpc.com/deny-list: "{{ azimuth_capi_operator_cluster_template_tenancy_deny_list | join(',') }}"
  acl.azimuth.stackhpc.com/allow-regex: "{{ azimuth_capi_operator_cluster_template_tenancy_allow_regex }}"
  acl.azimuth.stackhpc.com/deny-regex: "{{ azimuth_capi_operator_cluster_template_tenancy_deny_regex }}"
# By default, make a template for each Kubernetes release for which we have an image
azimuth_capi_operator_cluster_templates_default: |-
  {
    {% for key, image in community_images.items() %}
    {% if "kubernetes_version" in image %}
    {% set kube_vn_no_prefix = image.kubernetes_version | regex_replace('^v', '') %}
    {% set kube_vn_dash = kube_vn_no_prefix | replace('.', '-') %}
    "kube-{{ kube_vn_dash }}": {
      "annotations": {{ azimuth_capi_operator_cluster_template_annotations }},
      "spec": {{
        azimuth_capi_operator_cluster_template_defaults |
          combine(
            {
              "label": image.kubernetes_version,
              "description": "Kubernetes " ~ kube_vn_no_prefix ~ " with HA control plane.",
              "values": {
                "kubernetesVersion": kube_vn_no_prefix,
                "machineImageId": community_images_image_ids[key],
              },
            },
            recursive = True
          )
      }},
    },
    {% endif %}
    {% endfor %}
  }
# Allow extra templates to be defined using a separate variable
azimuth_capi_operator_cluster_templates_extra: {}
# The full list of Kubernetes cluster templates to install
azimuth_capi_operator_cluster_templates: >-
  {{-
    azimuth_capi_operator_cluster_templates_default |
      combine(azimuth_capi_operator_cluster_templates_extra, recursive = True)
  }}


#####
# Kubernetes app template definitions
# azimuth-ops currently never removes app templates
#####
# Indicates whether the Zenith-enabled JupyterHub app template should be enabled
azimuth_capi_operator_app_templates_jupyterhub_enabled: true
# The Helm chart to use for the JupyterHub app template
azimuth_capi_operator_app_templates_jupyterhub_chart_name: jupyterhub-azimuth
# The Helm repository to use for the JupyterHub app template
azimuth_capi_operator_app_templates_jupyterhub_chart_repo: https://azimuth-cloud.github.io/azimuth-charts
# The version range to use for the JupyterHub Helm chart
azimuth_capi_operator_app_templates_jupyterhub_version_range: ">=0.0.0"
# Overrides for the label, logo and description from the JupyterHub Helm chart
azimuth_capi_operator_app_templates_jupyterhub_label:
azimuth_capi_operator_app_templates_jupyterhub_logo:
azimuth_capi_operator_app_templates_jupyterhub_description:
# The number of versions to make available for the JupyterHub app template
azimuth_capi_operator_app_templates_jupyterhub_keep_versions: 3
# The sync frequency for the JupyterHub app template (default 24h)
azimuth_capi_operator_app_templates_jupyterhub_sync_frequency: 86400
# Any default values for the JupyterHub app template
azimuth_capi_operator_app_templates_jupyterhub_default_values: {}
# The tenancy-based access controls for the app template
# List of allowed tenancy IDs
azimuth_capi_operator_app_templates_jupyterhub_tenancy_allow_list: "{{ platforms_tenancy_allow_list | default([]) }}"
# List of denied tenancy IDs
azimuth_capi_operator_app_templates_jupyterhub_tenancy_deny_list: "{{ platforms_tenancy_deny_list | default([]) }}"
# Regex pattern to allow tenancies by name
azimuth_capi_operator_app_templates_jupyterhub_tenancy_allow_regex: "{{ platforms_tenancy_allow_regex | default('') }}"
# Regex pattern to block tenancies by name
azimuth_capi_operator_app_templates_jupyterhub_tenancy_deny_regex: "{{ platforms_tenancy_deny_regex | default('') }}"
# The set of key-value annotations to apply to the template
azimuth_capi_operator_app_templates_jupyterhub_annotations:
  acl.azimuth.stackhpc.com/allow-list: "{{ azimuth_capi_operator_app_templates_jupyterhub_tenancy_allow_list | join(',') }}"
  acl.azimuth.stackhpc.com/deny-list: "{{ azimuth_capi_operator_app_templates_jupyterhub_tenancy_deny_list | join(',') }}"
  acl.azimuth.stackhpc.com/allow-regex: "{{ azimuth_capi_operator_app_templates_jupyterhub_tenancy_allow_regex }}"
  acl.azimuth.stackhpc.com/deny-regex: "{{ azimuth_capi_operator_app_templates_jupyterhub_tenancy_deny_regex }}"
# The spec for the JupyterHub app template
azimuth_capi_operator_app_templates_jupyterhub_spec:
  annotations: "{{ azimuth_capi_operator_app_templates_jupyterhub_annotations }}"
  spec: >-
    {{-
      {
        "chart": {
          "repo": azimuth_capi_operator_app_templates_jupyterhub_chart_repo,
          "name": azimuth_capi_operator_app_templates_jupyterhub_chart_name,
        },
        "versionRange": azimuth_capi_operator_app_templates_jupyterhub_version_range,
        "keepVersions": azimuth_capi_operator_app_templates_jupyterhub_keep_versions,
        "syncFrequency": azimuth_capi_operator_app_templates_jupyterhub_sync_frequency,
        "defaultValues": azimuth_capi_operator_app_templates_jupyterhub_default_values,
      } |
        combine(
          { "label": azimuth_capi_operator_app_templates_jupyterhub_label }
          if azimuth_capi_operator_app_templates_jupyterhub_label
          else {}
        ) |
        combine(
          { "logo": azimuth_capi_operator_app_templates_jupyterhub_logo }
          if azimuth_capi_operator_app_templates_jupyterhub_logo
          else {}
        ) |
        combine(
          { "description": azimuth_capi_operator_app_templates_jupyterhub_description }
          if azimuth_capi_operator_app_templates_jupyterhub_description
          else {}
        )
    }}

# Indicates whether the Zenith-enabled DaskHub app template should be enabled
azimuth_capi_operator_app_templates_daskhub_enabled: true
# The Helm chart to use for the DaskHub app template
azimuth_capi_operator_app_templates_daskhub_chart_name: daskhub-azimuth
# The Helm repository to use for the DaskHub app template
azimuth_capi_operator_app_templates_daskhub_chart_repo: https://azimuth-cloud.github.io/azimuth-charts
# The version range to use for the DaskHub Helm chart
azimuth_capi_operator_app_templates_daskhub_version_range: ">=0.0.0"
# Overrides for the label, logo and description from the DaskHub Helm chart
azimuth_capi_operator_app_templates_daskhub_label:
azimuth_capi_operator_app_templates_daskhub_logo:
azimuth_capi_operator_app_templates_daskhub_description:
# The number of versions to make available for the DaskHub app template
azimuth_capi_operator_app_templates_daskhub_keep_versions: 3
# The sync frequency for the DaskHub app template (default 24h)
azimuth_capi_operator_app_templates_daskhub_sync_frequency: 86400
# Any defaultn values for the DaskHub app template
azimuth_capi_operator_app_templates_daskhub_default_values: {}
# The tenancy-based access controls for the app template
# List of allowed tenancy IDs
azimuth_capi_operator_app_templates_daskhub_tenancy_allow_list: "{{ platforms_tenancy_allow_list | default([]) }}"
# List of denied tenancy IDs
azimuth_capi_operator_app_templates_daskhub_tenancy_deny_list: "{{ platforms_tenancy_deny_list | default([]) }}"
# Regex pattern to allow tenancies by name
azimuth_capi_operator_app_templates_daskhub_tenancy_allow_regex: "{{ platforms_tenancy_allow_regex | default('') }}"
# Regex pattern to block tenancies by name
azimuth_capi_operator_app_templates_daskhub_tenancy_deny_regex: "{{ platforms_tenancy_deny_regex | default('') }}"
# The set of key-value annotations to apply to the template
azimuth_capi_operator_app_templates_daskhub_annotations:
  acl.azimuth.stackhpc.com/allow-list: "{{ azimuth_capi_operator_app_templates_daskhub_tenancy_allow_list | join(',') }}"
  acl.azimuth.stackhpc.com/deny-list: "{{ azimuth_capi_operator_app_templates_daskhub_tenancy_deny_list | join(',') }}"
  acl.azimuth.stackhpc.com/allow-regex: "{{ azimuth_capi_operator_app_templates_daskhub_tenancy_allow_regex }}"
  acl.azimuth.stackhpc.com/deny-regex: "{{ azimuth_capi_operator_app_templates_daskhub_tenancy_deny_regex }}"
# The spec for the DaskHub app template
azimuth_capi_operator_app_templates_daskhub_spec:
  annotations: "{{ azimuth_capi_operator_app_templates_daskhub_annotations }}"
  spec: >-
    {{-
      {
        "chart": {
          "repo": azimuth_capi_operator_app_templates_daskhub_chart_repo,
          "name": azimuth_capi_operator_app_templates_daskhub_chart_name,
        },
        "versionRange": azimuth_capi_operator_app_templates_daskhub_version_range,
        "keepVersions": azimuth_capi_operator_app_templates_daskhub_keep_versions,
        "syncFrequency": azimuth_capi_operator_app_templates_daskhub_sync_frequency,
        "defaultValues": azimuth_capi_operator_app_templates_daskhub_default_values,
      } |
        combine(
          { "label": azimuth_capi_operator_app_templates_daskhub_label }
          if azimuth_capi_operator_app_templates_daskhub_label
          else {}
        ) |
        combine(
          { "logo": azimuth_capi_operator_app_templates_daskhub_logo }
          if azimuth_capi_operator_app_templates_daskhub_logo
          else {}
        ) |
        combine(
          { "description": azimuth_capi_operator_app_templates_daskhub_description }
          if azimuth_capi_operator_app_templates_daskhub_description
          else {}
        )
    }}

# Indicates whether the Zenith-enabled kubeflow app template should be enabled
azimuth_capi_operator_app_templates_kubeflow_enabled: true
# The Helm chart to use for the kubeflow app template
azimuth_capi_operator_app_templates_kubeflow_chart_name: kubeflow-azimuth
# The Helm repository to use for the kubeflow app template
azimuth_capi_operator_app_templates_kubeflow_chart_repo: https://azimuth-cloud.github.io/azimuth-charts
# The version range to use for the kubeflow Helm chart
azimuth_capi_operator_app_templates_kubeflow_version_range: ">=0.0.0"
# Overrides for the label, logo and description from the kubeflow Helm chart
azimuth_capi_operator_app_templates_kubeflow_label:
azimuth_capi_operator_app_templates_kubeflow_logo:
azimuth_capi_operator_app_templates_kubeflow_description:
# The number of versions to make available for the kubeflow app template
azimuth_capi_operator_app_templates_kubeflow_keep_versions: 3
# The sync frequency for the kubeflow app template (default 24h)
azimuth_capi_operator_app_templates_kubeflow_sync_frequency: 86400
# Any default values for the kubeflow app template
azimuth_capi_operator_app_templates_kubeflow_default_values: {}
# The tenancy-based access controls for the app template
# List of allowed tenancy IDs
azimuth_capi_operator_app_templates_kubeflow_tenancy_allow_list: "{{ platforms_tenancy_allow_list | default([]) }}"
# List of denied tenancy IDs
azimuth_capi_operator_app_templates_kubeflow_tenancy_deny_list: "{{ platforms_tenancy_deny_list | default([]) }}"
# Regex pattern to allow tenancies by name
azimuth_capi_operator_app_templates_kubeflow_tenancy_allow_regex: "{{ platforms_tenancy_allow_regex | default('') }}"
# Regex pattern to block tenancies by name
azimuth_capi_operator_app_templates_kubeflow_tenancy_deny_regex: "{{ platforms_tenancy_deny_regex | default('') }}"
# The set of key-value annotations to apply to the template
azimuth_capi_operator_app_templates_kubeflow_annotations:
  acl.azimuth.stackhpc.com/allow-list: "{{ azimuth_capi_operator_app_templates_kubeflow_tenancy_allow_list | join(',') }}"
  acl.azimuth.stackhpc.com/deny-list: "{{ azimuth_capi_operator_app_templates_kubeflow_tenancy_deny_list | join(',') }}"
  acl.azimuth.stackhpc.com/allow-regex: "{{ azimuth_capi_operator_app_templates_kubeflow_tenancy_allow_regex }}"
  acl.azimuth.stackhpc.com/deny-regex: "{{ azimuth_capi_operator_app_templates_kubeflow_tenancy_deny_regex }}"
# The spec for the kubeflow app template
azimuth_capi_operator_app_templates_kubeflow_spec:
  annotations: "{{ azimuth_capi_operator_app_templates_kubeflow_annotations }}"
  spec: >-
    {{-
      {
        "chart": {
          "repo": azimuth_capi_operator_app_templates_kubeflow_chart_repo,
          "name": azimuth_capi_operator_app_templates_kubeflow_chart_name,
        },
        "versionRange": azimuth_capi_operator_app_templates_kubeflow_version_range,
        "keepVersions": azimuth_capi_operator_app_templates_kubeflow_keep_versions,
        "syncFrequency": azimuth_capi_operator_app_templates_kubeflow_sync_frequency,
        "defaultValues": azimuth_capi_operator_app_templates_kubeflow_default_values,
      } |
        combine(
          { "label": azimuth_capi_operator_app_templates_kubeflow_label }
          if azimuth_capi_operator_app_templates_kubeflow_label
          else {}
        ) |
        combine(
          { "logo": azimuth_capi_operator_app_templates_kubeflow_logo }
          if azimuth_capi_operator_app_templates_kubeflow_logo
          else {}
        ) |
        combine(
          { "description": azimuth_capi_operator_app_templates_kubeflow_description }
          if azimuth_capi_operator_app_templates_kubeflow_description
          else {}
        )
    }}

# Indicates whether the Zenith-enabled binderhub app template should be enabled
azimuth_capi_operator_app_templates_binderhub_enabled: true
# The Helm chart to use for the binderhub app template
azimuth_capi_operator_app_templates_binderhub_chart_name: binderhub-azimuth
# The Helm repository to use for the binderhub app template
azimuth_capi_operator_app_templates_binderhub_chart_repo: https://azimuth-cloud.github.io/azimuth-charts
# The version range to use for the binderhub Helm chart
azimuth_capi_operator_app_templates_binderhub_version_range: ">=0.0.0"
# Overrides for the label, logo and description from the binderhub Helm chart
azimuth_capi_operator_app_templates_binderhub_label:
azimuth_capi_operator_app_templates_binderhub_logo:
azimuth_capi_operator_app_templates_binderhub_description:
# The number of versions to make available for the binderhub app template
azimuth_capi_operator_app_templates_binderhub_keep_versions: 3
# The sync frequency for the binderhub app template (default 24h)
azimuth_capi_operator_app_templates_binderhub_sync_frequency: 86400
# Indicates whether binderhub should use http or https prefix in redirect urls
azimuth_capi_operator_app_templates_binderhub_use_https_redirects: "{{ ingress_tls_enabled | default(True) }}"
# Any default values for the binderhub app template
azimuth_capi_operator_app_templates_binderhub_default_values:
  binderhub_oauth_use_https: "{{ azimuth_capi_operator_app_templates_binderhub_use_https_redirects }}"
# The tenancy-based access controls for the app template
# List of allowed tenancy IDs
azimuth_capi_operator_app_templates_binderhub_tenancy_allow_list: "{{ platforms_tenancy_allow_list | default([]) }}"
# List of denied tenancy IDs
azimuth_capi_operator_app_templates_binderhub_tenancy_deny_list: "{{ platforms_tenancy_deny_list | default([]) }}"
# Regex pattern to allow tenancies by name
azimuth_capi_operator_app_templates_binderhub_tenancy_allow_regex: "{{ platforms_tenancy_allow_regex | default('') }}"
# Regex pattern to block tenancies by name
azimuth_capi_operator_app_templates_binderhub_tenancy_deny_regex: "{{ platforms_tenancy_deny_regex | default('') }}"
# The set of key-value annotations to apply to the template
azimuth_capi_operator_app_templates_binderhub_annotations:
  acl.azimuth.stackhpc.com/allow-list: "{{ azimuth_capi_operator_app_templates_binderhub_tenancy_allow_list | join(',') }}"
  acl.azimuth.stackhpc.com/deny-list: "{{ azimuth_capi_operator_app_templates_binderhub_tenancy_deny_list | join(',') }}"
  acl.azimuth.stackhpc.com/allow-regex: "{{ azimuth_capi_operator_app_templates_binderhub_tenancy_allow_regex }}"
  acl.azimuth.stackhpc.com/deny-regex: "{{ azimuth_capi_operator_app_templates_binderhub_tenancy_deny_regex }}"
# The spec for the binderhub app template
azimuth_capi_operator_app_templates_binderhub_spec:
  annotations: "{{ azimuth_capi_operator_app_templates_binderhub_annotations }}"
  spec: >-
    {{-
      {
        "chart": {
          "repo": azimuth_capi_operator_app_templates_binderhub_chart_repo,
          "name": azimuth_capi_operator_app_templates_binderhub_chart_name,
        },
        "versionRange": azimuth_capi_operator_app_templates_binderhub_version_range,
        "keepVersions": azimuth_capi_operator_app_templates_binderhub_keep_versions,
        "syncFrequency": azimuth_capi_operator_app_templates_binderhub_sync_frequency,
        "defaultValues": azimuth_capi_operator_app_templates_binderhub_default_values,
      } |
        combine(
          { "label": azimuth_capi_operator_app_templates_binderhub_label }
          if azimuth_capi_operator_app_templates_binderhub_label
          else {}
        ) |
        combine(
          { "logo": azimuth_capi_operator_app_templates_binderhub_logo }
          if azimuth_capi_operator_app_templates_binderhub_logo
          else {}
        ) |
        combine(
          { "description": azimuth_capi_operator_app_templates_binderhub_description }
          if azimuth_capi_operator_app_templates_binderhub_description
          else {}
        )
    }}

# Indicates whether the Zenith-enabled huggingface_llm app template should be enabled
azimuth_capi_operator_app_templates_huggingface_llm_enabled: true
# The Helm chart to use for the huggingface_llm app template
azimuth_capi_operator_app_templates_huggingface_llm_chart_name: azimuth-llm-chat
# The Helm repository to use for the huggingface_llm app template
azimuth_capi_operator_app_templates_huggingface_llm_chart_repo: https://stackhpc.github.io/azimuth-llm
# The version range to use for the huggingface_llm Helm chart
azimuth_capi_operator_app_templates_huggingface_llm_version_range: ">=0.0.0"
# Overrides for the label, logo and description from the huggingface_llm Helm chart
azimuth_capi_operator_app_templates_huggingface_llm_label:
azimuth_capi_operator_app_templates_huggingface_llm_logo: https://huggingface.co/datasets/huggingface/brand-assets/resolve/main/hf-logo.svg
azimuth_capi_operator_app_templates_huggingface_llm_description: |
  A generative AI chatbot service backed by a HuggingFace large language model
  (requires a GPU node group on the target cluster).
# The number of versions to make available for the huggingface_llm app template
azimuth_capi_operator_app_templates_huggingface_llm_keep_versions: 3
# The sync frequency for the huggingface_llm app template (default 24h)
azimuth_capi_operator_app_templates_huggingface_llm_sync_frequency: 86400
# Any default values for the huggingface_llm app template
azimuth_capi_operator_app_templates_huggingface_llm_default_values: {}
# The tenancy-based access controls for the app template
# List of allowed tenancy IDs
azimuth_capi_operator_app_templates_huggingface_llm_tenancy_allow_list: "{{ platforms_tenancy_allow_list | default([]) }}"
# List of denied tenancy IDs
azimuth_capi_operator_app_templates_huggingface_llm_tenancy_deny_list: "{{ platforms_tenancy_deny_list | default([]) }}"
# Regex pattern to allow tenancies by name
azimuth_capi_operator_app_templates_huggingface_llm_tenancy_allow_regex: "{{ platforms_tenancy_allow_regex | default('') }}"
# Regex pattern to block tenancies by name
azimuth_capi_operator_app_templates_huggingface_llm_tenancy_deny_regex: "{{ platforms_tenancy_deny_regex | default('') }}"
# The set of key-value annotations to apply to the template
azimuth_capi_operator_app_templates_huggingface_llm_annotations:
  acl.azimuth.stackhpc.com/allow-list: "{{ azimuth_capi_operator_app_templates_huggingface_llm_tenancy_allow_list | join(',') }}"
  acl.azimuth.stackhpc.com/deny-list: "{{ azimuth_capi_operator_app_templates_huggingface_llm_tenancy_deny_list | join(',') }}"
  acl.azimuth.stackhpc.com/allow-regex: "{{ azimuth_capi_operator_app_templates_huggingface_llm_tenancy_allow_regex }}"
  acl.azimuth.stackhpc.com/deny-regex: "{{ azimuth_capi_operator_app_templates_huggingface_llm_tenancy_deny_regex }}"
# The spec for the huggingface_llm app template
azimuth_capi_operator_app_templates_huggingface_llm_spec:
  annotations: "{{ azimuth_capi_operator_app_templates_huggingface_llm_annotations }}"
  spec: >-
    {{-
      {
        "chart": {
          "repo": azimuth_capi_operator_app_templates_huggingface_llm_chart_repo,
          "name": azimuth_capi_operator_app_templates_huggingface_llm_chart_name,
        },
        "versionRange": azimuth_capi_operator_app_templates_huggingface_llm_version_range,
        "keepVersions": azimuth_capi_operator_app_templates_huggingface_llm_keep_versions,
        "syncFrequency": azimuth_capi_operator_app_templates_huggingface_llm_sync_frequency,
        "defaultValues": azimuth_capi_operator_app_templates_huggingface_llm_default_values,
      } |
        combine(
          { "label": azimuth_capi_operator_app_templates_huggingface_llm_label }
          if azimuth_capi_operator_app_templates_huggingface_llm_label
          else {}
        ) |
        combine(
          { "logo": azimuth_capi_operator_app_templates_huggingface_llm_logo }
          if azimuth_capi_operator_app_templates_huggingface_llm_logo
          else {}
        ) |
        combine(
          { "description": azimuth_capi_operator_app_templates_huggingface_llm_description }
          if azimuth_capi_operator_app_templates_huggingface_llm_description
          else {}
        )
    }}

#####
# Danswer/Onyx app template
#####

# Indicates whether the Danswer app template should be enabled
azimuth_capi_operator_app_templates_danswer_enabled: false
# The Helm chart to use for the danswer app template
azimuth_capi_operator_app_templates_danswer_chart_name: danswer-stack
# The Helm repository to use for the danswer app template
azimuth_capi_operator_app_templates_danswer_chart_repo: https://stackhpc.github.io/danswer
# The version range to use for the danswer Helm chart
azimuth_capi_operator_app_templates_danswer_version_range: ">=0.0.0"
# Overrides for the label, logo and description from the danswer Helm chart
azimuth_capi_operator_app_templates_danswer_label: Danswer
azimuth_capi_operator_app_templates_danswer_logo: >-
  https://raw.githubusercontent.com/danswer-ai/danswer/1fabd9372d66cd54238847197c33f091a724803b/DanswerWithName.png
azimuth_capi_operator_app_templates_danswer_description: A self-service platform for Retrieval-Augmented Generation.
# The number of versions to make available for the danswer app template
azimuth_capi_operator_app_templates_danswer_keep_versions: 3
# The sync frequency for the danswer app template (default 24h)
azimuth_capi_operator_app_templates_danswer_sync_frequency: 86400
# Any default values for the danswer app template
azimuth_capi_operator_app_templates_danswer_default_values:
  inferenceCapability:
    pvc:
      # Default 3GB volumes are too small for some
      # embedding models to download correctly.
      storage: 10Gi
    deployment:
      resources:
        requests:
          memory: 4Gi
  indexCapability:
    indexingModelPVC:
      storage: 10Gi
    deployment:
      resources:
        requests:
          memory: 4Gi
  background:
    resources:
      requests:
        memory: 4Gi

# The tenancy-based access controls for the app template
# List of allowed tenancy IDs
azimuth_capi_operator_app_templates_danswer_tenancy_allow_list: "{{ platforms_tenancy_allow_list | default([]) }}"
# List of denied tenancy IDs
azimuth_capi_operator_app_templates_danswer_tenancy_deny_list: "{{ platforms_tenancy_deny_list | default([]) }}"
# Regex pattern to allow tenancies by name
azimuth_capi_operator_app_templates_danswer_tenancy_allow_regex: "{{ platforms_tenancy_allow_regex | default('') }}"
# Regex pattern to block tenancies by name
azimuth_capi_operator_app_templates_danswer_tenancy_deny_regex: "{{ platforms_tenancy_deny_regex | default('') }}"
# The set of key-value annotations to apply to the template
azimuth_capi_operator_app_templates_danswer_annotations:
  acl.azimuth.stackhpc.com/allow-list: "{{ azimuth_capi_operator_app_templates_danswer_tenancy_allow_list | join(',') }}"
  acl.azimuth.stackhpc.com/deny-list: "{{ azimuth_capi_operator_app_templates_danswer_tenancy_deny_list | join(',') }}"
  acl.azimuth.stackhpc.com/allow-regex: "{{ azimuth_capi_operator_app_templates_danswer_tenancy_allow_regex }}"
  acl.azimuth.stackhpc.com/deny-regex: "{{ azimuth_capi_operator_app_templates_danswer_tenancy_deny_regex }}"
# The spec for the danswer app template
azimuth_capi_operator_app_templates_danswer_spec:
  annotations: "{{ azimuth_capi_operator_app_templates_danswer_annotations }}"
  spec: >-
    {{-
      {
        "chart": {
          "repo": azimuth_capi_operator_app_templates_danswer_chart_repo,
          "name": azimuth_capi_operator_app_templates_danswer_chart_name,
        },
        "versionRange": azimuth_capi_operator_app_templates_danswer_version_range,
        "keepVersions": azimuth_capi_operator_app_templates_danswer_keep_versions,
        "syncFrequency": azimuth_capi_operator_app_templates_danswer_sync_frequency,
        "defaultValues": azimuth_capi_operator_app_templates_danswer_default_values,
      } |
        combine(
          { "label": azimuth_capi_operator_app_templates_danswer_label }
          if azimuth_capi_operator_app_templates_danswer_label
          else {}
        ) |
        combine(
          { "logo": azimuth_capi_operator_app_templates_danswer_logo }
          if azimuth_capi_operator_app_templates_danswer_logo
          else {}
        ) |
        combine(
          { "description": azimuth_capi_operator_app_templates_danswer_description }
          if azimuth_capi_operator_app_templates_danswer_description
          else {}
        )
    }}


#####
# RAGFlow app template
#####

# Indicates whether the ragflow app template should be enabled
azimuth_capi_operator_app_templates_ragflow_enabled: false
# The Helm chart to use for the ragflow app template
azimuth_capi_operator_app_templates_ragflow_chart_name: ragflow-azimuth
# The Helm repository to use for the ragflow app template
azimuth_capi_operator_app_templates_ragflow_chart_repo: https://stackhpc.github.io/ragflow
# The version range to use for the ragflow Helm chart
azimuth_capi_operator_app_templates_ragflow_version_range: ">=0.1.0"
# Overrides for the label, logo and description from the ragflow Helm chart
azimuth_capi_operator_app_templates_ragflow_label: RAGFlow
azimuth_capi_operator_app_templates_ragflow_logo:
azimuth_capi_operator_app_templates_ragflow_description:
# The number of versions to make available for the ragflow app template
azimuth_capi_operator_app_templates_ragflow_keep_versions: 3
# The sync frequency for the ragflow app template (default 24h)
azimuth_capi_operator_app_templates_ragflow_sync_frequency: 86400
# Any default values for the ragflow app template
azimuth_capi_operator_app_templates_ragflow_default_values: {}
# The tenancy-based access controls for the app template
# List of allowed tenancy IDs
azimuth_capi_operator_app_templates_ragflow_tenancy_allow_list: "{{ platforms_tenancy_allow_list | default([]) }}"
# List of denied tenancy IDs
azimuth_capi_operator_app_templates_ragflow_tenancy_deny_list: "{{ platforms_tenancy_deny_list | default([]) }}"
# Regex pattern to allow tenancies by name
azimuth_capi_operator_app_templates_ragflow_tenancy_allow_regex: "{{ platforms_tenancy_allow_regex | default('') }}"
# Regex pattern to block tenancies by name
azimuth_capi_operator_app_templates_ragflow_tenancy_deny_regex: "{{ platforms_tenancy_deny_regex | default('') }}"
# The set of key-value annotations to apply to the template
azimuth_capi_operator_app_templates_ragflow_annotations:
  acl.azimuth.stackhpc.com/allow-list: "{{ azimuth_capi_operator_app_templates_ragflow_tenancy_allow_list | join(',') }}"
  acl.azimuth.stackhpc.com/deny-list: "{{ azimuth_capi_operator_app_templates_ragflow_tenancy_deny_list | join(',') }}"
  acl.azimuth.stackhpc.com/allow-regex: "{{ azimuth_capi_operator_app_templates_ragflow_tenancy_allow_regex }}"
  acl.azimuth.stackhpc.com/deny-regex: "{{ azimuth_capi_operator_app_templates_ragflow_tenancy_deny_regex }}"
# The spec for the ragflow app template
azimuth_capi_operator_app_templates_ragflow_spec:
  annotations: "{{ azimuth_capi_operator_app_templates_ragflow_annotations }}"
  spec: >-
    {{-
      {
        "chart": {
          "repo": azimuth_capi_operator_app_templates_ragflow_chart_repo,
          "name": azimuth_capi_operator_app_templates_ragflow_chart_name,
        },
        "versionRange": azimuth_capi_operator_app_templates_ragflow_version_range,
        "keepVersions": azimuth_capi_operator_app_templates_ragflow_keep_versions,
        "syncFrequency": azimuth_capi_operator_app_templates_ragflow_sync_frequency,
        "defaultValues": azimuth_capi_operator_app_templates_ragflow_default_values,
      } |
        combine(
          { "label": azimuth_capi_operator_app_templates_ragflow_label }
          if azimuth_capi_operator_app_templates_ragflow_label
          else {}
        ) |
        combine(
          { "logo": azimuth_capi_operator_app_templates_ragflow_logo }
          if azimuth_capi_operator_app_templates_ragflow_logo
          else {}
        ) |
        combine(
          { "description": azimuth_capi_operator_app_templates_ragflow_description }
          if azimuth_capi_operator_app_templates_ragflow_description
          else {}
        )
    }}


#####
# Argo CD app template
#####

# Indicates whether the Argo CD app template should be enabled
azimuth_capi_operator_app_templates_argocd_enabled: true
# The Helm chart to use for the argocd app template
azimuth_capi_operator_app_templates_argocd_chart_name: argocd-azimuth
# The Helm repository to use for the argocd app template
azimuth_capi_operator_app_templates_argocd_chart_repo: https://azimuth-cloud.github.io/azimuth-charts
# The version range to use for the argocd Helm chart
azimuth_capi_operator_app_templates_argocd_version_range: ">=0.0.0"
# Overrides for the label, logo and description from the argocd Helm chart
azimuth_capi_operator_app_templates_argocd_label:
azimuth_capi_operator_app_templates_argocd_logo:
azimuth_capi_operator_app_templates_argocd_description:
# The number of versions to make available for the argocd app template
azimuth_capi_operator_app_templates_argocd_keep_versions: 3
# The sync frequency for the argocd app template (default 24h)
azimuth_capi_operator_app_templates_argocd_sync_frequency: 86400
# Any default values for the argocd app template
azimuth_capi_operator_app_templates_argocd_default_values: {}
# The tenancy-based access controls for the app template
# List of allowed tenancy IDs
azimuth_capi_operator_app_templates_argocd_tenancy_allow_list: "{{ platforms_tenancy_allow_list | default([]) }}"
# List of denied tenancy IDs
azimuth_capi_operator_app_templates_argocd_tenancy_deny_list: "{{ platforms_tenancy_deny_list | default([]) }}"
# Regex pattern to allow tenancies by name
azimuth_capi_operator_app_templates_argocd_tenancy_allow_regex: "{{ platforms_tenancy_allow_regex | default('') }}"
# Regex pattern to block tenancies by name
azimuth_capi_operator_app_templates_argocd_tenancy_deny_regex: "{{ platforms_tenancy_deny_regex | default('') }}"
# The set of key-value annotations to apply to the template
azimuth_capi_operator_app_templates_argocd_annotations:
  acl.azimuth.stackhpc.com/allow-list: "{{ azimuth_capi_operator_app_templates_argocd_tenancy_allow_list | join(',') }}"
  acl.azimuth.stackhpc.com/deny-list: "{{ azimuth_capi_operator_app_templates_argocd_tenancy_deny_list | join(',') }}"
  acl.azimuth.stackhpc.com/allow-regex: "{{ azimuth_capi_operator_app_templates_argocd_tenancy_allow_regex }}"
  acl.azimuth.stackhpc.com/deny-regex: "{{ azimuth_capi_operator_app_templates_argocd_tenancy_deny_regex }}"
# The spec for the argocd app template
azimuth_capi_operator_app_templates_argocd_spec:
  annotations: "{{ azimuth_capi_operator_app_templates_argocd_annotations }}"
  spec: >-
    {{-
      {
        "chart": {
          "repo": azimuth_capi_operator_app_templates_argocd_chart_repo,
          "name": azimuth_capi_operator_app_templates_argocd_chart_name,
        },
        "versionRange": azimuth_capi_operator_app_templates_argocd_version_range,
        "keepVersions": azimuth_capi_operator_app_templates_argocd_keep_versions,
        "syncFrequency": azimuth_capi_operator_app_templates_argocd_sync_frequency,
        "defaultValues": azimuth_capi_operator_app_templates_argocd_default_values,
      } |
        combine(
          { "label": azimuth_capi_operator_app_templates_argocd_label }
          if azimuth_capi_operator_app_templates_argocd_label
          else {}
        ) |
        combine(
          { "logo": azimuth_capi_operator_app_templates_argocd_logo }
          if azimuth_capi_operator_app_templates_argocd_logo
          else {}
        ) |
        combine(
          { "description": azimuth_capi_operator_app_templates_argocd_description }
          if azimuth_capi_operator_app_templates_argocd_description
          else {}
        )
    }}


# The default templates
azimuth_capi_operator_app_templates_default: >-
  {{-
    {} |
      combine(
        { "jupyterhub": azimuth_capi_operator_app_templates_jupyterhub_spec }
        if azimuth_capi_operator_app_templates_jupyterhub_enabled
        else {}
      ) |
      combine(
        { "daskhub": azimuth_capi_operator_app_templates_daskhub_spec }
        if azimuth_capi_operator_app_templates_daskhub_enabled
        else {}
      ) |
      combine(
        { "kubeflow": azimuth_capi_operator_app_templates_kubeflow_spec }
        if azimuth_capi_operator_app_templates_kubeflow_enabled
        else {}
      ) |
      combine(
        { "binderhub": azimuth_capi_operator_app_templates_binderhub_spec }
        if azimuth_capi_operator_app_templates_binderhub_enabled
        else {}
      ) |
      combine(
        { "argocd": azimuth_capi_operator_app_templates_argocd_spec }
        if azimuth_capi_operator_app_templates_argocd_enabled
        else {}
      ) |
      combine(
        { "huggingface-llm": azimuth_capi_operator_app_templates_huggingface_llm_spec }
        if azimuth_capi_operator_app_templates_huggingface_llm_enabled
        else {}
      ) |
            combine(
        { "danswer": azimuth_capi_operator_app_templates_danswer_spec }
        if azimuth_capi_operator_app_templates_danswer_enabled
        else {}
      ) |
            combine(
        { "ragflow": azimuth_capi_operator_app_templates_ragflow_spec }
        if azimuth_capi_operator_app_templates_ragflow_enabled
        else {}
      )
  }}

# Allow extra templates to be defined using a separate variable
azimuth_capi_operator_app_templates_extra: {}
# The full list of Kubernetes app templates to install
azimuth_capi_operator_app_templates: >-
  {{-
    azimuth_capi_operator_app_templates_default |
      combine(azimuth_capi_operator_app_templates_extra, recursive = True)
  }}
