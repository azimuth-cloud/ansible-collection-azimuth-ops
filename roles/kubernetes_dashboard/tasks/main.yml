---
- name: Uninstall Kubernetes dashboard on target Kubernetes cluster
  kubernetes.core.helm:
    release_namespace: "{{ kubernetes_dashboard_release_namespace }}"
    release_name: "{{ kubernetes_dashboard_release_name }}"
    state: absent
    wait: true
    wait_timeout: "{{ kubernetes_dashboard_wait_timeout }}"

- name: Remove Kubernetes dashboard ingress
  ansible.builtin.command: >-
    kubectl delete ingress
      {{ admin_dashboard_ingress_kubernetes_dashboard_name | default('kubernetes-dashboard') }}
      --namespace {{ admin_dashboard_ingress_kubernetes_dashboard_namespace | default('kubernetes-dashboard') }}
  register: kubernetes_dashboard_delete_ingress
  changed_when: kubernetes_dashboard_delete_ingress.rc == 0
  failed_when: >-
    kubernetes_dashboard_delete_ingress.rc != 0 and
    "NotFound" not in kubernetes_dashboard_delete_ingress.stderr
